<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="libs/aja/aja.min.js" async></script>
</head>
<body>
    <input name="setId" title="Set Id" id="setId" type="text"/>
    <button onclick="getSetData()" type="button">GetData</button>

    <ul id="links">
        <li><a>Rebrickable link</a></li>
        <li><a>Brickset link</a></li>
        <li><a>BrickLink link</a></li>
    </ul>

    <div>
        <a href="" id="allegro-name"></a>
        <div id="allegro-price"></div>
    </div>

    <div id="result">

    </div>
<script>
    var resultEl = document.getElementById('result');
    var setIdInput = document.getElementById('setId');

    function getSetData() {
        var setId = setIdInput.value;

        aja()
            .url('/getSet/'+ setId)
            .on('success', function(data){
                fillLinks(data.links);
                fillAllegro(data.allegro.itemsList);

                resultEl.innerHTML = JSON.stringify(data);
            })
            .go();
    }

    function fillAllegro(itemsList){
        var priceEl = document.getElementById('allegro-price');
        var href = document.getElementById('allegro-name');
        var cheapestData = bestAllegroPricedItem(itemsList);

        href.href = cheapestData.href;
        href.textContent = cheapestData.name;
        priceEl.textContent = cheapestData.price;
    }
    
    function bestAllegroPricedItem(itemsList) {
        var cheapest = itemsList[0];
        return {
            price: cheapest.priceInfo[0].priceValue,
            name: cheapest.itemTitle,
            href: 'http://allegro.pl/show_item.php?item=' + cheapest.itemId,
        };
    }

    function fillLinks(links) {
        var linksList = document.getElementById('links');
        var rebrickablePlaceholder = linksList.children[0];
        var bricksetPlaceholder = linksList.children[1];
        var brickLinkPlaceholder = linksList.children[2];

        rebrickablePlaceholder.firstChild.href = links.rebrickable;
        bricksetPlaceholder.firstChild.href = links.brickset;
        brickLinkPlaceholder.firstChild.href = links.bricklink;
    }
</script>
</body>
</html>